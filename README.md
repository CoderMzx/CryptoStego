#CryptoStego  
JS library for steganography with encryption - Hide text in an image with encryption and obfuscation.    
##Download  
Download [cryptostego.min.js](https://github.com/zeruniverse/CryptoStego/releases/download/v1.0/cryptostego.min.js)  
**Note: This JS library needs HTML5 support!**  
##Usage  
This library provides 3 functions. Use `<script src="cryptostego.min.js"></script>` in your HTML to include this library.  
### `loadIMGtoCanvas(inputid, canvasid, callback, maxsize=0)`  
This function loads an image from file input to a dynamically generated canvas. After that, it will call `callback()` function to do some stuff, and then delete the generated canvas.
  + `inputid` is the id of the html5 file input.
    + You need to put a file input element like `<input type="file" id="file" accept="image/*" />` in your HTML and ask user to select an image here.  
  + `canvasid` is the id of the canvas that this function will generate. **`canvasid` will be generated by this function dynamically when called.** You will use this `canvasid` in `callback()` to locate the canvas.    
    + **You must use an id that not currently used in your HTML**, When this function is called, a canvas with id to be `canvasid` will be created. Then, the image selected by user will be loaded to this canvas.  
    + **Canvas created by this function (`canvasid`) will be deleted after finishing calling callback function.** So you might want to copy image in this canvas to another canvas in callback function or trig a download in callback function.  
  + `callback` is the callback function that will be called after image successfully loaded to canvas.
    + Use `canvasid` to locate the canvas in `callback()` function.  
    + `canvasid` will be deleted after calling `callback()`. Make sure you store all data needed in `callback` function.  
    + An example for callback -> download the result image after steganography:
    ``` JavaScript
    //callback function is writefunc()
    function writefunc(){
        if(writeMsgToCanvas('canvas',$("#msg").val(),$("#pass").val(),true)!=null){ 
        var myCanvas = document.getElementById("canvas"); //canvasid='canvas'  
        var image = myCanvas.toDataURL("image/jpg");    
        var element = document.createElement('a');
        element.setAttribute('href', image);
        element.setAttribute('download', 'result.jpg');
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);        
        }
    }
    //For convenience, jQuery is used here. But that's not necessary.
    loadIMGtoCanvas('file','canvas',writefunc,500);
    ```
  + `maxsize` is the max width or height for created canvas (default value is 0)  
    + If either image width or image height larger than `maxsize`, This function scale the image so that it fits the generated canvas with width and height not larger than `maxsize`  
    + If `maxsize`<=0, image will not be scaled (use original size). This is not recommended if your callback function is steganography function (write info to image). As super large image will make browser dead. A recommended value is 500.  
    + Make sure when callback function is reading info from image, your `maxsize` is at least the `maxsize` you use for steganography. As steganography algorithm is not robust to scale.    
  
### `writeMsgToCanvas(canvasid,msg,pass='',fft=false,copy=5,blocksizepow=2,lim=80)`  
This function writes your message into image in canvas `canvasid`. Before calling this function, make sure some image is loaded in `canvasid`. Usually, this function will be called in callback function of `loadIMGtoCanvas`  
+ `canvasid` specifies the id of the canvas to whose image the message will be written to.  
+ `msg` specifies the message.  
+ `pass` specifies the password for retrieving the message.  
+ `fft` specifies whether to use fast Fourier mode or LSB mode.  
  + `true` -> fast Fourier mode, result image robust to image compression.  
  + `false` -> LSB mode (default), result more similar to original image.  
**All options below only work if you use fast Fourier mode**, and those options should be same in `writeMsg` and `readMsg`    
+ `copy` specifies how many copies of message to keep in this image (defalut value is 5)  
  + `copy`=n means we will keep n identical copies of the message in this image. So if some is corrupted, we still have the correct message. 
  + `copy` is recommended to be odd integer  
  + The larger the `copy` is, the less information the image can hold, and the more robustness to image compression the message has.  
+ `blocksizepow` specifies the blocksize for fast Fourier transformation. (default value is 2)  
  + `blocksize = 2^(blocksizepow)`. If `blocksizepow=2`, the fast Fourier transformation will be performed per 4*4 block.  
  + Setting `blocksizepow` too large might slow down the process.  
+ `lim` specifies the difference between a `true` value and a `false` value (default value is 80)  
  + All information stored in frequency domain is binary. The larger the `lim` is, the less likely message will be corrupted.   
  + The larger the `lim` is, the more difference the result image will have compared to original image, and the more robustness to image compression the message has.  
+ Return value is either `null` or `1`, `null` stands for `fail` and `1` stands for `success`.  
  
### `readMsgFromCanvas(canvasid,pass='',fft=false,copy=5,blocksizepow=2,lim=80)`  
This function reads your message from image in canvas `canvasid`. Before calling this function, make sure some image is loaded in `canvasid`. Usually, this function will be called in callback function of `loadIMGtoCanvas`  
+ **To successfully read message, `pass`,`fft`,`copy`,`blocksizepow`,`lim` should be same as what you use in `writeMsgToCanvas`. And the image in `canvasid` should be the result image of `writeMsgToCanvas`.  
+ All parameters have same meaning as in `writeMsgToCanvas`.  
+ Return value is a string or `null`  
  + `null` means fail to read message. It might caused by wrong password, wrong image or wrong parameters.  
  + returned string is the message retrieved. It might be some meaning less characters on error.  
