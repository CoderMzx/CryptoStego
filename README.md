#CryptoStego  
JS library for steganography with encryption - Hide text in an image with encryption and obfuscation.    
I only tested this library in Chrome and Firefox. Please submit an issue if there're bugs in other browsers!  
##DEMO  
[http://zeruniverse.github.io/CryptoStego/](http://zeruniverse.github.io/CryptoStego/)  
**Note: Library needs HTML5 support!**
  
##Download  
Download [cryptostego.min.js](https://github.com/zeruniverse/CryptoStego/releases/download/v1.0/cryptostego.min.js)  
**Note: This JS library needs HTML5 support!**  
  
##Features  
+ Random initialization of invalid bits - obfuscation  
+ Non-linear bit-by-bit message storage.    
+ Valid bits and their order decided by sha512-based hash function  
+ Password decides the parameter in hash function. Different password will map message to different locations in the image  
+ No signal for password error. Wrong password results in wrong message  
  
##LSB (Least Significant Bit) mode
  + Use least significant bits of RGB channels of each pixels to store message  
  + Result image visually identical to original image  
  + Can only stored in non-compressed format such as PNG  
  
##Fast Fourier mode
  + Store information by slightly changing lowest frequency component of each block in frequency domain  
  + Robust to image compression but stores less data compared to LSB mode  
  + Result image looks different from original one  
  
##Usage  
This library provides 3 functions. Use `<script src="cryptostego.min.js"></script>` in your HTML to include this library.  
### `loadIMGtoCanvas(inputid, canvasid, callback, maxsize=0)`  
This function loads an image from file input to a dynamically generated canvas. After that, it will call `callback()` function to do some stuff, and then delete the generated canvas.
  + `inputid` is the id of the html5 file input.
    + You need to put a file input element like `<input type="file" id="file" accept="image/*" />` in your HTML and ask user to select an image here.  
  + `canvasid` is the id of the canvas that this function will generate. **`canvasid` will be generated by this function dynamically when called.** You will use this `canvasid` in `callback()` to locate the canvas.    
    + **You must use an id that not currently used in your HTML**, When this function is called, a canvas with id to be `canvasid` will be created. Then, the image selected by user will be loaded to this canvas.  
    + **Canvas created by this function (`canvasid`) will be deleted after finishing calling callback function.** So you might want to copy image in this canvas to another canvas in callback function or trig a download in callback function.  
  + `callback` is the callback function that will be called after image successfully loaded to canvas.
    + Use `canvasid` to locate the canvas in `callback()` function.  
    + `canvasid` will be deleted after calling `callback()`. Make sure you store all data needed in `callback` function.  
    + An example for callback -> download the result image after steganography:
    ``` JavaScript
    //callback function is writefunc()
    function writefunc(){
        if(writeMsgToCanvas('canvas',$("#msg").val(),$("#pass").val(),true)!=null){ 
        var myCanvas = document.getElementById("canvas"); //canvasid='canvas'  
        var image = myCanvas.toDataURL("image/jpg");    
        var element = document.createElement('a');
        element.setAttribute('href', image);
        element.setAttribute('download', 'result.jpg');
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);        
        }
    }
    //For convenience, jQuery is used here. But that's not necessary.
    loadIMGtoCanvas('file','canvas',writefunc,500);
    ```
  + `maxsize` is the max width or height for created canvas (default value is 0)  
    + If either image width or image height larger than `maxsize`, This function scale the image so that it fits the generated canvas with width and height not larger than `maxsize`  
    + If `maxsize`<=0, image will not be scaled (use original size). This is not recommended if your callback function is steganography function (write info to image). As super large image will make browser dead. A recommended value is 500.  
    + Make sure when callback function is reading info from image, your `maxsize` is at least the `maxsize` you use for steganography. As steganography algorithm is not robust to scale.    
  
### `writeMsgToCanvas(canvasid,msg,pass='',fft=false,copy=5,blocksizepow=2,lim=80)`  
This function writes your message into image in canvas `canvasid`. Before calling this function, make sure some image is loaded in `canvasid`. Usually, this function will be called in callback function of `loadIMGtoCanvas`  
+ `canvasid` specifies the id of the canvas to whose image the message will be written to.  
+ `msg` specifies the message.  
+ `pass` specifies the password for retrieving the message.  
+ `fft` specifies whether to use fast Fourier mode or LSB mode.  
  + `true` -> fast Fourier mode, result image robust to image compression.  
  + `false` -> LSB mode (default), result more similar to original image.  
  
**All options below only work if you use fast Fourier mode**, and those options should be same in `writeMsg` and `readMsg`   
   
+ `copy` specifies how many copies of message to keep in this image (defalut value is 5)  
  + `copy`=n means we will keep n identical copies of the message in this image. So if some is corrupted, we still have the correct message. 
  + `copy` is recommended to be odd integer  
  + The larger the `copy` is, the less information the image can hold, and the more robustness to image compression the message has.  
+ `blocksizepow` specifies the blocksize for fast Fourier transformation. (default value is 2)  
  + `blocksize = 2^(blocksizepow)`. If `blocksizepow=2`, the fast Fourier transformation will be performed per 4*4 block.  
  + Setting `blocksizepow` too large might slow down the process.  
+ `lim` specifies the difference between a `true` value and a `false` value (default value is 80)  
  + All information stored in frequency domain is binary. The larger the `lim` is, the less likely message will be corrupted.   
  + The larger the `lim` is, the more difference the result image will have compared to original image, and the more robustness to image compression the message has.  
+ Return value is either `null` or `1`, `null` stands for `fail` and `1` stands for `success`.  
  
### `readMsgFromCanvas(canvasid,pass='',fft=false,copy=5,blocksizepow=2,lim=80)`  
This function reads your message from image in canvas `canvasid`. Before calling this function, make sure some image is loaded in `canvasid`. Usually, this function will be called in callback function of `loadIMGtoCanvas`  
+ **To successfully read message, `pass`,`fft`,`copy`,`blocksizepow`,`lim` should be same as what you use in `writeMsgToCanvas`. And the image in `canvasid` should be the result image of `writeMsgToCanvas`.**  
+ All parameters have same meaning as in `writeMsgToCanvas`.  
+ Return value is a string or `null`  
  + `null` means fail to read message. It might caused by wrong password, wrong image or wrong parameters.  
  + returned string is the message retrieved. It might be some meaningless characters on error.  
  
##Compression Robustness for fast Fourier mode  
###Raw image and data  
Image before encryption (268KB in PNG format):  
![dandelionclock](https://cloud.githubusercontent.com/assets/4648756/15265727/6b29773e-1941-11e6-9245-3275ff0afcf2.jpg)  

Data:  
```
你好，世界！
HELLO WORLD!
¡HOLA MUNDO!
مرحبا بالعالم!
BONJOUR LE MONDE!
こんにちは世界！
ПРИВЕТ МИР!
```

Use empty password and default value of `blocksizepow`, `copy` and `lim`  
  
##Compression Ratio 56.0% (150KB)  
![result 3](https://cloud.githubusercontent.com/assets/4648756/15265750/1986efc8-1942-11e6-8f4e-754e4c221f62.jpg)  
Retrieved data correct!  
  
##Compression Ratio 25.8% (69.1KB)  
![optimized-result 3](https://cloud.githubusercontent.com/assets/4648756/15265761/7e502a0a-1942-11e6-918e-f86fce06b001.jpg)  
Retrieved data correct!  
  
##Compression Ratio 16.8% (44.9KB)  
![result 3 1](https://cloud.githubusercontent.com/assets/4648756/15265783/5202b476-1943-11e6-921d-cbf1e1b76075.jpg)  
Result:  
```
你好，世界！
HELLO WORLD!
¡HKL`MUODO!
х阍٨اب诙عالم!
BONJOUR LE MONDE!
こ㊓ㅫメは世界！
ПȠИВЕТ ܐ萠!
```  
Mostly correct!  
  
##Compression Ratio 10% (26.8KB)  
![result 3 __1463194197_207 23 217 104](https://cloud.githubusercontent.com/assets/4648756/15265804/fc1d9c6e-1943-11e6-8325-6a5575447c8b.jpg)  
Result:  
```
你祽，世界＃
ōLO,׏RLD!
áHόA mUNLG 
معЭ記砘蘧لؙܧلمኂϊJOUr(Le MONDQc
こんにちは世界！
ПРИВЕТ МИР!
```  
Half correct!  
  
##Compression Ratio 2.35% (6.3KB)  
![result 3 __1463194357_207 23 217 104](https://cloud.githubusercontent.com/assets/4648756/15265818/7c9b7352-1944-11e6-9f32-3136fcdfb57d.jpg)  
Result:  
```
ERROR RETRIEVING MESSAGE
```  
Corrupted!  
  
##Coding Example  
See `example/` folder  
  
##Copyright  
Jeffery Zhao  
License: GNU **A**GPL v3.0 or later  
The copyright for Crypto-JS is reserved by its authors.  
